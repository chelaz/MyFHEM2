<!-- Example URL:
http://madita/config/index.html?options=%7B%22FS20%22%3A%5B%7B%22State%22%3A%22toggle%22%2C%22Device%22%3A%22FS20_fr_bel%22%2C%22Alias%22%3A%22Licht%20umschalten%22%2C%22Room%22%3A%22K%C3%BCche%22%7D%2C%7B%22State%22%3A%22toggle%22%2C%22Device%22%3A%22FS20_fz_bel%22%2C%22Alias%22%3A%22Licht%20an%2Faus%22%2C%22Room%22%3A%22Wohnzimmer%22%7D%5D%2C%22num%22%3A2%7D&return_to=https%3A//cloudpebble.net/ide/emulator/config%3F
https://rawgit.com/chelaz/MyFHEM2/master/config/index.html?options=%7B%22FS20%22%3A%5B%7B%22State%22%3A%22toggle%22%2C%22Device%22%3A%22FS20_fr_bel%22%2C%22Alias%22%3A%22Licht%20umschalten%22%2C%22Room%22%3A%22K%C3%BCche%22%7D%2C%7B%22State%22%3A%22toggle%22%2C%22Device%22%3A%22FS20_fz_bel%22%2C%22Alias%22%3A%22Licht%20an%2Faus%22%2C%22Room%22%3A%22Wohnzimmer%22%7D%5D%2C%22num%22%3A2%7D&return_to=https%3A//cloudpebble.net/ide/emulator/config%3F
-->

<!--
  Documenation of JSON Data Exchange
  ----------------------------------
  
  From PebbleJS: FHEM_Devices
  --------------
  	{ "FS20" : [
  		{ "State"  : "toggle",
  		  "Device" : "FS20_fr_bel",
  		  "Alias"  : "Licht umschalten",
  		  "Room"   : "K端che"
  		},
  		{ "State"  : "toggle",
  		  "Device" : "FS20_fz_bel",
  		  "Alias"  : "Licht an/aus",
  		  "Room"   : "Wohnzimmer"
  		}
  	  ],
  	  "num" : 2
  	}
  
  
  To PebbleJS:   FHEM_Config
  --------------
	{ "FHEM_SERVER_URL" : "http://mypi:8083/fhem",
	  "Cfg_Devices"     : {
	  	"FS20" : [
	  	  { "State"     : "toggle",
	  	    "StateText" : "umschalten",
	  	    "Device"    : "FS20_fr_bel",
	  	    "Alias"     : "Licht",
	  	    "Descr"     : "Licht umschalten",
	  	    "Room"      : "K端che",
	  	    "Check"     : 2
	  	  },
	  	  { "State"     : "on",
	  	    "StateText" : "an",
	  	    "Device"    : "FS20_fr_bel",
	  	    "Alias"     : "Licht",
	  	    "Descr"     : "Licht an",
	  	    "Room"      : "K端che",
	  	    "Check"     : 1
	  	  },
	  	  { "State"     : "off",
	  	    "StateText" : "aus",
	  	    "Device"    : "FS20_fr_bel",
	  	    "Alias"     : "Licht",
	  	    "Descr"     : "Licht aus",
	  	    "Room"      : "K端che",
	  	    "Check"     : 1
	  	  },
	  	  ...
	  	]
	  }
	}

-->


<!DOCTYPE html>
<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
<html>
  <div id="CommitNumber" hidden> 58 </div>
  <head>
  <title>WristFHEM - Pebble App for FHEM Home Automation Server</title>
  <link rel='stylesheet' type='text/css' href='css/slate.css'>
  <!--script src='js/slate.js'></script-->
  <style>
  .title {
    padding: 15px 10px;
    text-transform: uppercase;
    font-family: 'PT Sans', sans-serif;
    font-size: 1.2em;j
    font-weight: 500;
    color: #888888;
    text-align: center;
  }
  </style>
  </head>

  <body>
    <h1 class='title'>WristFHEM - Home Automation on your Wrist
    </h1>

    <div class='item-container'>
      <div class='item-container-content'>
        <div class='item-container-footer'>
	  Please dontate to support and motivate the further development of
	  this watch app by spending
	  <a
	    href="bitcoin:18YzPQVfQ5ss51uvgGJQ5MfbbK28S9ebbP?label=Pebble%20FHEM%20Donation"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Bitcoin_logo.svg/220px-Bitcoin_logo.svg.png" height="16"alt="Bitcoin" target="Donation"></a> (for more details see Wikipedia&#8217;s <a href="http://en.wikipedia.org/wiki/Bitcoin">Bitcoin</a>&nbsp;article).
	  
        </div>
      </div>
    </div>

    <div class='item-container'>
      <div class='item-container-header'>Server Configuration</div>
      <div class='item-container-content'>
        <label class='item'>
          Server URL
          <input id='FHEM_SERVER_URL' type='text' value='http://localhost:8083/fhem'>
        </label>
      </div>
      <div class='item-container-footer'>
	Please specify FHEM server URL. Note https is not yet supported as well
	as username/password access. Example: <em>http://www.myfhem.org:8083/fhem</em>.
      </div>
    </div>

    <div class='item-container'>
      <div class='item-container-header'>FS20 Devices <!-- button id="RequestFS20fromFHEM">Request FS20 Devices</button--></div>
      <div class='item-container-content'>
        <div id="FS20Content">...</div>
      </div>
      <div class='item-container-footer'>
	You can see all FS20 devices of your FHEM server.
      </div>
    </div>

    <!--div class='item-container'>
      <div class='item-container-header'>Accessibility</div>
      <div class='item-container-content'>
        <label class='item'>
          High Contrast Mode
          <input id='high_contrast_checkbox' type='checkbox' class='item-toggle'>
        </label>
      </div>
      <div class='item-container-footer'>
        This switches the app colors to a higher contrast set that promotes readability in low light.
      </div>
    </div-->

    <div class='item-container'>
      <div class='button-container'>
        <input id='submit_button' type='button' class='item-button' value='SUBMIT'>
      </div>
    </div>
    <div class='item-container'>
      <div class='item-container-header'>Debug Console</div>
      <div class='item-container-footer'><ul id="Console"><li>Status: Ready</li></ul>
      </div>
    </div>
  </body>
  
  
  <!-- --------------------------------------------------------------------------------------------------
  	javascript starts here -->
  <script>
  
  var Debug=true;
  
  
  
  ////////////////////////////////////
  // General Helper Functions

  // Set the return URL depending on the runtime environment
  function getQueryParam(variable, defaultValue) {
    var query = location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split('=');
      if (pair[0] === variable) {
        return decodeURIComponent(pair[1]);
      }
    }
    return defaultValue || false;
  }

  // Extract the args from the URI of this document
  // Returns the string corresponding to the given key
  // Example: var optionsString = getQueryString("options", "foobar");  // for "URL=https://localhost/index.html?options=FOOBAR"
  function getQueryString(key, default_) {
	  if (default_ == null) default_ = "";
	  key = key.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
	  var regex = new RegExp("[\\?&]" + key + "=([^&#]*)");
	  var qs = regex.exec(window.location.href);
	  if (qs == null)
	    return default_;
	  else
	    return decodeURIComponent(qs[1]);
  }

  /////////////////////////////////////
  // Submit button clicked 
  var submitButton = document.getElementById('submit_button');
  submitButton.addEventListener('click', function() {
    console.log('Submit');

    var ReturnString = JSON.stringify(getInputMain());

    if (Debug)
      return;

    var return_to = getQueryParam('return_to', 'pebblejs://close#');
    document.location = return_to + encodeURIComponent(ReturnString);
  });


  function MyConsole(text)
  {
    var Console = document.getElementById('Console');
    Console.innerHTML += "<li>" + text + "</li>";
  }

  ////////////////////////////////////
  // Defines for checkbuttons
  var MenuDef   = 1;
  var MenuFav   = 2;
  var MenuState = 4;

  // -----------------------------------------------------
  // Read data from HTML Input

  function GetInputServerURL(return_opts)
  {
    var FHEM_SERVER_URL_textinput = document.getElementById('FHEM_SERVER_URL');
    return_opts['FHEM_SERVER_URL'] = FHEM_SERVER_URL_textinput.value;

    // Save for next launch
    localStorage['FHEM_SERVER_URL'] = return_opts['FHEM_SERVER_URL'];

    return return_opts;
  }

  /*
    IDs: 
       Room (check) Device_0
       Descr:       Device_0_descr
                    Device_0_descr_button

       Check_fav_t: Device_0_toggle_fav
       Check_dict:  Device_0_toggle_dict
                    Device_0_toggle_text        (text: toggle/umschalten)
                    Device_0_toggle_text_button
                    Device_0_on_fav
                    Device_0_on_dict
                    Device_0_on_text
                    Device_0_on_text_button
                    Device_0_off_fav
                    Device_0_off_dict
                    Device_0_off_text
                    Device_0_off_text_button
                    Device_0_state     
  */

  // Helper function
  function AddCfgDeviceFromInput(Cfg_Devices_Type,
  				 IDBasename,
  				 DeviceName,
  				 HtmlRoomText_value,
  				 HtmlDescrText_value,
  				 state)
  {
    var IDCheckBasename = IDBasename + "_" + state;
    var HtmlFav  = document.getElementById(IDCheckBasename+"_fav");
    var HtmlDict = document.getElementById(IDCheckBasename+"_dict");
    var HtmlStateText = document.getElementById(IDCheckBasename+"_text");
    var CheckBits = (HtmlDict.checked) ? MenuDef : 0;
    CheckBits    |= (HtmlFav.checked)  ? MenuFav : 0;
         
    if (CheckBits != 0) {
      Cfg_Devices_Type.push( 
           { 
            "State"     : state,
            "StateText" : HtmlStateText.value,
            "Device"    : DeviceName,
            "Alias"     : HtmlDescrText_value,
            "Descr"     : HtmlDescrText_value + " " + HtmlStateText.value,
            "Room"      : HtmlRoomText_value,
            "Check"     : CheckBits
           });
       return true;
     }
     return false;
  }
  

  function GetInputDevices(return_opts, DeviceType)
  {
    // todo: rearrange localstorage for Cfg_Devices
    
    var Key = "FHEM_DEVICES_" + DeviceType;
    
    var FHEM_Devices = JSON.parse(localStorage[Key]);
    
    if (FHEM_Devices.num == null || FHEM_Devices.num == 0)
      return return_opts;
    
    var Cfg_Devices = {}
    Cfg_Devices[DeviceType] = [];
    // console.log('Cfg_Devices: ' + JSON.stringify(FHEM_Devices));
    var cnt=0;
    for (var i=0; i < FHEM_Devices.num; i++) {
    	
      // fetch all IDs
      var IDBasename     = "Device_" + i;
      var HtmlCk         = document.getElementById(IDBasename);
      var HtmlDescrText  = document.getElementById(IDBasename+"_descr");
      var HtmlRoomText_value = FHEM_Devices[DeviceType][i].Room; // todo
      
      if (HtmlCk.checked) {
      	
      	if (AddCfgDeviceFromInput(Cfg_Devices[DeviceType], IDBasename, FHEM_Devices[DeviceType][i].Device, 
  				 HtmlRoomText_value, HtmlDescrText.value, "toggle"))
  	  cnt++;
      	if (AddCfgDeviceFromInput(Cfg_Devices[DeviceType], IDBasename, FHEM_Devices[DeviceType][i].Device, 
  				 HtmlRoomText_value, HtmlDescrText.value, "on"))
  	  cnt++;
      	if (AddCfgDeviceFromInput(Cfg_Devices[DeviceType], IDBasename, FHEM_Devices[DeviceType][i].Device, 
  				 HtmlRoomText_value, HtmlDescrText.value, "off"))
  	  cnt++;
      	
      	      /*
      // toggle      
      var HtmlToggleFav  = document.getElementById(IDBasename+"_toggle_fav");
      var HtmlToggleDict = document.getElementById(IDBasename+"_toggle_dict");
      var HtmlToggleText = document.getElementById(IDBasename+"_toggle_text");
      var CheckToggleBits = (HtmlToggleDict.checked) ? MenuDef : 0;
      CheckToggleBits    |= (HtmlToggleFav.checked)  ? MenuFav : 0;
      
      // on
      var HtmlOnFav      = document.getElementById(IDBasename+"_on_fav");
      var HtmlOnDict     = document.getElementById(IDBasename+"_on_dict");
      var HtmlOnText     = document.getElementById(IDBasename+"_on_text");
      var CheckOnBits     = (HtmlOnDict.checked)     ? MenuDef : 0;
      CheckOnBits        |= (HtmlOnFav.checked)      ? MenuFav : 0;
      
      // off
      var HtmlOffFav     = document.getElementById(IDBasename+"_off_fav");
      var HtmlOffDict    = document.getElementById(IDBasename+"_off_dict");
      var HtmlOffText    = document.getElementById(IDBasename+"_off_text");
      var CheckOffBits    = (HtmlOffDict.checked)    ? MenuDef : 0;
      CheckOffBits       |= (HtmlOffFav.checked)     ? MenuFav : 0;
      */

        /* if (CheckToggleBits != 0) {
          Cfg_Devices[DeviceType].push( 
           { 
            "State"  : "toggle",
            "Device" : FHEM_Devices[DeviceType][i].Device,
            "Descr"  : HtmlDescrText.value + " " +HtmlToggleText.value,
            "Room"   : FHEM_Devices[DeviceType][i].Room,
            "Check"  : CheckToggleBits
           });
          cnt++;
        } */
        
        /*if (CheckOnBits != 0) {
          Cfg_Devices[DeviceType].push( 
           { 
            "State"  : "on",
            "Device" : FHEM_Devices[DeviceType][i].Device,
            "Descr"  : HtmlDescrText.value + " " +HtmlOnText.value,
            "Room"   : FHEM_Devices[DeviceType][i].Room,
            "Check"  : CheckOnBits
           });
          cnt++;
        } */
        
        /*
        if (CheckOffBits != 0) {
          Cfg_Devices[DeviceType].push( 
           { 
            "State"  : "off",
            "Device" : FHEM_Devices[DeviceType][i].Device,
            "Descr"  : HtmlDescrText.value + " " +HtmlOffText.value,
            "Room"   : FHEM_Devices[DeviceType][i].Room,
            "Check"  : CheckOffBits
           });
          cnt++;
        }*/
        
        var HtmlState      = document.getElementById(IDBasename+"_state");
        if (HtmlState.checked != 0) {
          Cfg_Devices[DeviceType].push( 
           { 
            "State"     : "toggle",
            "StateText" : "toggle", /* irrelevant */
            "Device" : FHEM_Devices[DeviceType][i].Device,
            "Alias"  : HtmlDescrText.value,
            "Descr"  : HtmlDescrText.value,
            "Room"   : HtmlRoomText_value,
            "Check"  : MenuState
           });
          cnt++;
        }
    // FHEM_Devices[DeviceType][i].checked = true;
        cnt++;
      } else
        FHEM_Devices[DeviceType][i].checked = false;
    }
    return_opts['Cfg_Devices'] = Cfg_Devices;
    return return_opts;
  }

  // Input main function
  function getInputMain() {

    DeviceType = "FS20";

    var FHEM_Config = {}

    FHEM_Config = GetInputServerURL(FHEM_Config);    
    FHEM_Config = GetInputDevices(FHEM_Config, DeviceType);

    var FHEM_Config_Str = JSON.stringify(FHEM_Config);

    MyConsole("FHEM_Config: " + FHEM_Config_Str);

    localStorage["FHEM_Config"] = FHEM_Config_Str;

    return FHEM_Config;
  }


  // -----------------------------------------------------
  // ...


  /////////////////////////////////////
  // Helper Functions

  // A button shows a text. If the user presses on the button
  // an edit control appears with the same text.
  // Used for the following HTML input:
  //  <label>
  //    <input id="inputID"       type="hidden" value="Text">
  //    <input id="buttonID" type="button" value="Text"
  //           onclick='ShowEdit("inputID","buttonID");'>
  //  </label>
  function ShowEdit(inputID, buttonID)
  {
    var HTMLInput = document.getElementById(inputID);
    HTMLInput.type = "text";
    var HTMLButton = document.getElementById(buttonID);
    HTMLButton.type = "hidden";
   }

  /////////////////////////////////////
  // Fetches all devices from args (URI) and shows it on the page
  function ShowDevicesFromArgs(DeviceType, HTMLElement)
  {
    function AddState2Device(i, Device, StateStr)
    {
      var EditID       = "\"Device_" + i + "_" + StateStr + "_text\"";
      var EditIDButton = "\"Device_" + i + "_" + StateStr + "_text_button\"";
      var RetStr = 	
	   "  <tr>\n" +
	   "    <td><label>\n" +
           "       <input id='Device_" + i + "_" + StateStr + "_fav' type='checkbox' "+
	   "           value='" + Device[i].checked + "'>\n" +
	   "    </label></td>\n" +
	   "    <td><label>\n" +
           "       <input id='Device_" + i + "_" + StateStr + "_dict' type='checkbox'"+
	   "           value='" + Device[i].checked + "'>\n" +
	   "    </label></td>\n" +
	   "    <td><label>\n" +
           "       <input id=" + EditID       + " type='hidden' "+
	   "           value='" + StateStr + "'>\n" + 
	   "       <input id=" + EditIDButton + " type='button' value='" + StateStr +
	   "        ' onclick='ShowEdit(" + EditID +"," + EditIDButton + ");'>" +
	   "    </label></td>\n" +
	   "  </tr>\n\n";
	   
      // console.log(RetStr);
      return RetStr;
    };

    var Default_FHEM_Devices = "{" + DeviceType + ":''}";
    var FHEM_DevicesString = getQueryString("options", Default_FHEM_Devices);
    
    MyConsole("From PebbleJS: "+FHEM_DevicesString);
    
    var FHEM_Devices = JSON.parse(FHEM_DevicesString);

    var Key = "FHEM_DEVICES_" + DeviceType;
    localStorage[Key] = FHEM_DevicesString;

    if (FHEM_Devices.num == null) {
      HTMLElement.innerHTML = "Nothing received from Pebble.js";
      return;
    }
    if (FHEM_Devices.num == 0) {
      HTMLElement.innerHTML = "No " + DeviceType + " devices found";
      return;
    }

    var FHEM_Config_prev = JSON.parse(localStorage["FHEM_Config"]);

    MyConsole("FHEM_Config_prev: " + JSON.stringify(FHEM_Config_prev));

    HTMLElement.innerHTML = "";

    // checked not yet working since the data from localStorage is overwritten above
    for (var i = 0; i < FHEM_Devices.num; i++) {
      var Alias = FHEM_Devices[DeviceType][i].Alias;
      
      // if (FHEM_Config_prev[])
      
      // TODO: check whether we already have saved a config in localStorage
      
      var EditID       = "\"Device_" + i + "_descr\"";
      var EditIDButton = "\"Device_" + i + "_descr_button\"";

      var ih = i+1;      
      var HTMLDevice =
         "<div class='item-container-content'><label>" + 
         " <!-- [" + ih + "/" + FHEM_Devices.num + "] -->" + 

         "  <input id='Device_" + i + "' type='checkbox' "+
	 "   value=" + FHEM_Devices[DeviceType][i].checked + ">" +
	 FHEM_Devices[DeviceType][i].Room +
	 "   </label>" +

         /* Description */
         "   <label>\n" +
         "       <input id=" + EditID       + " type='hidden' "+
	 "           value='" + Alias + "'>\n" + 
	 "       <input id=" + EditIDButton + " type='button' value='" + Alias +
	 "        ' onclick='ShowEdit(" + EditID +"," + EditIDButton + ");'>" +
	 "    </label>";
	 
         /* States choice */
	 HTMLDevice += 
	   " <table cellpadding='0' cellspacing='0'>" +
	   "  <!--tr id = 'header'>" +
	   "    <td>Fav</td>" +
	   "    <td>Dict</td>" +
	   "    <td>State</td>" +
	   "  </tr-->";
	 
	 HTMLDevice += AddState2Device(i, FHEM_Devices[DeviceType], 'toggle');
	 HTMLDevice += AddState2Device(i, FHEM_Devices[DeviceType], 'on');
	 HTMLDevice += AddState2Device(i, FHEM_Devices[DeviceType], 'off');

	 HTMLDevice +=
	   "  <tr>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_state' type='checkbox' "+
	   "           value=" + FHEM_Devices[DeviceType][i].checked + ">" +
	   "    </label></td>" +
	   "    <td></td>" +
	   "    <td>State of Device</td>" +
	   "  </tr>";

	 HTMLDevice += 
	   " </table>" +
	   "</div>";

	HTMLElement.innerHTML += HTMLDevice;
	
	// console.log("HTMLInner:--------------\n" + HTMLElement.innerHTML + "\n-------------------------\n");

/*	 HTMLElement.innerHTML += 
	   "  <tr id = 'toggle'>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_toggle_fav' type='checkbox' "+
	   "           value=" + FHEM_Types[DeviceType][i].checked + ">" +
	   "    </label></td>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_toggle_dict' type='checkbox' "+
	   "            value=" + FHEM_Types[DeviceType][i].checked + ">" +
	   "    </label></td>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_toggle_text' type='text' "+
	   "        value='toggle'>" +
	   "    </label></td>" +
	   "  </tr>" +
	   "  <tr id = 'on'>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_on_fav' type='checkbox' "+
	   "           value=" + FHEM_Types[DeviceType][i].checked + ">" +
	   "    </label></td>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_on_dict' type='checkbox' "+
	   "            value=" + FHEM_Types[DeviceType][i].checked + ">" +
	   "    </label></td>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_on_state' type='text' "+
	   "        value='on'>" +
	   "    </label></td>" +
	   "  </tr>" +
	   "  <tr id = 'on'>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_off_fav' type='checkbox' "+
	   "           value=" + FHEM_Types[DeviceType][i].checked + ">" +
	   "    </label></td>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_off_dict' type='checkbox' "+
	   "            value=" + FHEM_Types[DeviceType][i].checked + ">" +
	   "    </label></td>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_off_state' type='text' "+
	   "        value='off'>" +
	   "    </label></td>" +
	   "  </tr>" +
	   "  <tr id = 'state'>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_state_fav' type='checkbox' "+
	   "           value=" + FHEM_Types[DeviceType][i].checked + ">" +
	   "    </label></td>" +
	   "    <td><label>" +
           "       <input id='Device_" + i + "_state_dict' type='checkbox' "+
	   "            value=" + FHEM_Types[DeviceType][i].checked + ">" +
	   "    </label></td>" +
	   "    <td>State of Device</td>" +
	   "  </tr>" +
	   " </table>" +
	   "</div>";
*/	   
/*
	 
         "   <div class='item-container-content-small'>" +
	  // FHEM_Types[DeviceType][i].Descr +
	 "     <label>" +
         "       <input id='Device_" + i + "_toggle' type='checkbox' "+
	 "       value=" + FHEM_Types[DeviceType][i].checked +
	 "       >&nbsp;" + "toggle" +
	 "     </label>" +	 
	 "     <label>" +
         "       <input id='Device_" + i + "_on' type='checkbox' "+
	 "       value=" + FHEM_Types[DeviceType][i].checked +
	 "       >&nbsp;" + "on" +
	 "     </label>" +	 
	 "     <label>" +
         "       <input id='Device_" + i + "_off' type='checkbox' "+
	 "       value=" + FHEM_Types[DeviceType][i].checked +
	 "       >&nbsp;" + "off" +
	 "     </label>" +	 
	 "     <label>" +
         "       <input id='Device_" + i + "_state' type='checkbox' "+
	 "       value=" + FHEM_Types[DeviceType][i].checked +
	 "       >&nbsp;" + "state" +
	 "     </label>" +	 
	 "   </div>" + 
	 "  "+
	 "";
	 */
    }
  }


  /////////////////////////////////////
  // Main Function
  (function() {
    var Cnt = 0;
    var CntObj = localStorage['FHEM_CONFIG_CNT'];
    if (CntObj == null) {
      localStorage['FHEM_CONFIG_CNT'] = JSON.stringify(Cnt);
    } else {
      Cnt = JSON.parse(CntObj);
      localStorage['FHEM_CONFIG_CNT'] = JSON.stringify(Cnt+1);
    }
    MyConsole("Config Counter: " + localStorage['FHEM_CONFIG_CNT']);
    
    var TagCommitNumber = document.getElementById('CommitNumber');
    MyConsole("Commit: "+ TagCommitNumber.innerHTML);
     
    var FHEM_SERVER_URL_textinput = document.getElementById('FHEM_SERVER_URL');
    // var highContrastCheckbox = document.getElementById('high_contrast_checkbox');

    // Load any previously saved configuration, if available
    if(localStorage['FHEM_SERVER_URL']) {
      FHEM_SERVER_URL_textinput.value = localStorage['FHEM_SERVER_URL'];
      //highContrastCheckbox.checked = JSON.parse(localStorage['high_contrast']);
    }
    
    // for debugging: if args of URI are not present, the URI stays
    var FS20Element=document.getElementById('FS20Content');
    FS20Element.innerHTML = "URL of this document: <em>" + window.location.href + "</em>";

    ShowDevicesFromArgs("FS20", FS20Element);

  })();
  </script>
</html>
